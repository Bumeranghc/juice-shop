name: DevSecOps Example Workflows

on:
    workflow_dispatch:

jobs:
    secrets_scan:
        name: gitleaks
        runs-on: ubuntu-latest
        steps:
        - uses: actions/checkout@v5
          with:
            fetch-depth: 0

        - uses: gitleaks/gitleaks-action@v2
          env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

        - uses: trufflesecurity/trufflehog@main
          if: always()
          with:
            extra_args: --results=verified,unknown

    sast:
        name: semgrep
        if: always()
        runs-on: ubuntu-latest
        container: semgrep/semgrep:latest
        steps:
        - uses: actions/checkout@v5
          with:
            fetch-depth: 0
                    
        - run: |
            semgrep --version
            semgrep scan --config=auto . --sarif . > semgrep-results.sarif
            cat semgrep-results.sarif
